# Тестовое задание  
## Интернет-магазин «Петрушка Зеленая""

Репозиторий содержит решение тестового задания, включающего:
- анализ и корректировку требований,
- проектирование REST API,
- проектирование верхнеуровневой архитектуры PUSH-уведомлений.

---

## Задание 1. Анализ требований

### Исходные проблемы и противоречия в ТЗ

#### 1. Противоречие требований по количеству товара
- Указано, что минимальное количество товара — 1.
- Одновременно указано, что при уменьшении количества до 0 товар удаляется.

**Проблема:**  
Невозможно одновременно запрещать количество 0 и использовать его как механизм удаления.

---

#### 2. Дублирование способов удаления товара
- Удаление товара описано через отдельную кнопку.
- Также удаление происходит при уменьшении количества до 0.

**Проблема:**  
Не определено приоритетное поведение, возможны разные реализации на фронтенде.

---

#### 3. Противоречие в логике работы цены
- Цена фиксируется на момент добавления товара в корзину.
- Цена должна автоматически обновляться при изменении в каталоге.

**Проблема:**  
Требования взаимоисключающие, бизнес-логика не определена.

---

#### 4. Неоднозначность обработки лимитов корзины
- Ограничения:
  - не более 5 разных товаров,
  - не более 20 единиц суммарно,
  - не более 10 единиц одного товара.
- Сообщение об ошибке одно — «Лимит корзины превышен».

**Проблема:**  
Пользователь не понимает, какое именно ограничение нарушено.

---

#### 5. Избыточное требование
- «Товары в корзине могут быть разные».

**Проблема:**  
Требование не несет полезной информации и не влияет на реализацию.

---

#### 6. Неопределенность требований к рекламе
- Не указано:
  - что считается утром и вечером,
  - какой часовой пояс используется,
  - показывается ли реклама в выходные дни.

---

#### 7. Формальные ошибки
- Отсутствует пункт №12 в нумерации требований.

---

### Исправленная версия ТЗ (логически непротиворечивая)

#### Функционал корзины

1. Пользователь может добавить в корзину от **1 до 10 единиц одного товара**.
2. Минимальное количество товара в корзине — **1 единица**.
3. Уменьшение количества ниже 1 невозможно.
4. Для удаления товара из корзины используется **отдельная кнопка «Удалить»**.
5. В корзине может находиться **не более 5 различных товаров**.
6. Суммарное количество всех товаров в корзине **не может превышать 20 единиц**.
7. При превышении лимитов система отображает конкретное сообщение об ошибке:
   - «Превышено максимальное количество товара»
   - «Превышено максимальное количество разных товаров»
   - «Превышено максимальное общее количество товаров»
8. Цена товара **фиксируется на момент добавления в корзину** и не изменяется при обновлении цены в каталоге.
9. На странице корзины отображается:
   - название товара,
   - количество,
   - цена за единицу,
   - итоговая стоимость позиции,
   - общая сумма корзины.
10. В корзине может отображаться рекламный блок с товарами.
11. Рекламный блок отображается **в будние дни (Пн–Пт)**:
    - утро: **08:00–11:00**,
    - вечер: **18:00–21:00**,
    - используется локальное время пользователя.

---

### Уточняющие вопросы заказчику

1. Цена в корзине должна быть фиксированной или динамической?
2. Что происходит при одновременном превышении нескольких лимитов?
3. Должна ли корзина сохраняться между сессиями пользователя?
4. Привязана ли корзина к авторизованному пользователю?
5. Нужна ли возможность очистки корзины целиком?
6. Требуется ли персонализация рекламных блоков?
7. Какие события корзины должны отправляться в аналитику?

---

## Задание 2. Проектирование REST API

### Пример запроса

```http
GET /api/v1/partners/stores
Authorization: Bearer <token>
```

### Пример ответа

```json
{
  "stores": [
    {
      "id": "store_1",
      "name": "Магазин Фермер",
      "logo_url": "https://cdn.petrushka-green.ru/logos/farmer.png",
      "description": "Натуральные продукты от местных фермеров",
      "external_url": "https://farmer-shop.ru"
    },
    {
      "id": "store_2",
      "name": "Эко Лавка",
      "logo_url": "https://cdn.petrushka-green.ru/logos/eco.png",
      "description": "Экологичные товары для дома",
      "external_url": "https://eco-lavka.ru"
    }
  ]
}
```

При клике на карточку магазина пользователь перенаправляется по `external_url`.

---

## Задание 3. Архитектура PUSH-уведомлений

### Верхнеуровневая схема

```
Mobile App
   ↓
API Gateway
   ↓
Notification Service
   ↓
Message Broker (Kafka / RabbitMQ)
   ↓
Push Worker
   ↓
FCM / APNS
   ↓
User Device
```

### Описание логики

1. В системе происходит событие (изменение заказа, брошенная корзина, маркетинговая рассылка).
2. Микросервис-источник публикует событие в брокер сообщений.
3. Notification Service:

   * определяет тип уведомления,
   * проверяет настройки пользователя,
   * формирует payload.
4. Push Worker отправляет уведомление в FCM или APNS.
5. Клиентское приложение получает PUSH и обрабатывает deeplink.

### Преимущества подхода

* масштабируемость,
* слабая связность сервисов,
* возможность легко добавлять новые типы уведомлений.

---

## Заключение

Данное решение демонстрирует:

* умение выявлять противоречия в требованиях,
* навык формализации бизнес-логики,
* базовое понимание REST API и микросервисной архитектуры.
